# sdk (.doc.md)

## Purpose

- Provide `destiny-sdk` PyPI package for API consumers
- Define Pydantic models for all API contracts
- Provide client utilities for interacting with the DESTINY API
- Does **not** contain backend implementation logic

## Responsibilities

- Pydantic model definitions (references, enhancements, identifiers, imports, robots)
- HTTP client for API interactions
- Robot client for enhancement processing
- Authentication utilities
- Parser utilities for reference formats

## Key Entry Points

- `client.py` - Main HTTP client for API interactions
- `enhancements.py` - Enhancement types and models (read for `EnhancementType` enum)
- `identifiers.py` - Identifier types and models (read for `ExternalIdentifierType` enum)
- `robots.py` - Robot models and `RobotClient` for robot integrations
- `references.py` - Reference models
- `imports.py` - Import models

## Important Invariants / Constraints

- Models here define the API contract; changes affect all consumers
- Published to PyPI independently of the backend
- `py.typed` marker indicates full type annotation support
- Anti-corruption layer in backend translates between SDK and domain models

## Public Surface Area

### Main Exports

```python
from destiny_sdk import DestinyClient
from destiny_sdk.enhancements import EnhancementType, BibliographicMetadataEnhancement
from destiny_sdk.identifiers import ExternalIdentifierType, DOIIdentifier
from destiny_sdk.robots import RobotClient
from destiny_sdk.references import Reference
```

### Key Enums

- `EnhancementType` - BIBLIOGRAPHIC, ABSTRACT, ANNOTATION, LOCATION, etc.
- `ExternalIdentifierType` - DOI, OPENALEX, PUBMED, etc.

## Typical Workflows

### Adding a new enhancement type

1. Add to `EnhancementType` enum in `enhancements.py`
2. Create corresponding Pydantic model
3. Update backend anti-corruption service to handle new type

### Adding a new identifier type

1. Add to `ExternalIdentifierType` enum in `identifiers.py`
2. Create identifier model with validation
3. Update backend to recognize new identifier

## Testing

```bash
# Run SDK tests
uv run pytest libs/sdk/tests/

# Test from SDK directory
cd libs/sdk && uv run pytest
```

## Debugging Notes

- Validation errors? Check Pydantic model constraints
- Client errors? Check API base URL and authentication
- Type hints not working? Ensure `py.typed` exists

## Related Docs

- `docs/sdk/` - SDK usage documentation
- `docs/sdk/schemas.rst` - Schema documentation
- `app/domain/*/services/anti_corruption_service.py` - Translation layers
- `docs/repo-map.md` - Repository overview

## Folder Structure

```text
sdk/
├── src/destiny_sdk/
│   ├── __init__.py     # Package exports
│   ├── client.py       # Main API client
│   ├── auth.py         # Authentication utilities
│   ├── core.py         # Core types
│   ├── enhancements.py # Enhancement types and models
│   ├── identifiers.py  # Identifier types and models
│   ├── imports.py      # Import models
│   ├── references.py   # Reference models
│   ├── robots.py       # Robot models and client
│   ├── search.py       # Search models
│   ├── visibility.py   # Visibility models
│   ├── labs/           # Experimental features
│   ├── parsers/        # Reference format parsers
│   └── py.typed        # PEP 561 marker
├── tests/              # SDK-specific tests
├── pyproject.toml      # Package configuration
└── README.md           # SDK documentation
```
